var content=(function(){"use strict";var Ie=Object.defineProperty;var Me=(w,S,E)=>S in w?Ie(w,S,{enumerable:!0,configurable:!0,writable:!0,value:E}):w[S]=E;var u=(w,S,E)=>Me(w,typeof S!="symbol"?S+"":S,E);function w(s){return s}function S(s){const e=document.querySelector("#prompt-textarea");return e?(e.focus(),document.execCommand("insertText",!1,s)||(e.textContent=s,e.dispatchEvent(new Event("input",{bubbles:!0}))),!0):!1}function E(s){const e=document.querySelector('[contenteditable="true"]');return e?(e.focus(),document.execCommand("insertText",!1,s)||(e.textContent=s,e.dispatchEvent(new Event("input",{bubbles:!0}))),!0):!1}function Y(s){const e=document.querySelector(".ql-editor, [contenteditable='true']");return e?(e.focus(),document.execCommand("insertText",!1,s)||(e.textContent=s,e.dispatchEvent(new Event("input",{bubbles:!0}))),!0):!1}const O={response:'[data-message-author-role="assistant"]',streaming:".result-streaming"},Z=300;class X{constructor(){u(this,"observer",null);u(this,"debounceTimer",null);u(this,"lastSeenId",null);u(this,"currentStreamingEl",null)}start(e){this.observer=new MutationObserver(()=>{this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>this.check(e),Z)}),this.observer.observe(document.body,{childList:!0,subtree:!0,characterData:!0})}stop(){var e;(e=this.observer)==null||e.disconnect(),this.observer=null,this.debounceTimer&&clearTimeout(this.debounceTimer)}readLatestResponse(){var r;const e=document.querySelectorAll(O.response);return e.length===0?null:((r=e[e.length-1].textContent)==null?void 0:r.trim())||null}isResponseStreaming(){return document.querySelector(O.streaming)!==null}check(e){var a;const t=document.querySelectorAll(O.response);if(t.length===0)return;const r=t[t.length-1],i=r.getAttribute("data-message-id")||`chatgpt-${t.length}`;if(this.isResponseStreaming()){this.currentStreamingEl!==r&&(this.currentStreamingEl=r,e.onResponseStart(i));return}if(this.currentStreamingEl===r||i!==this.lastSeenId){this.currentStreamingEl=null,this.lastSeenId=i;const g=((a=r.textContent)==null?void 0:a.trim())||"";g&&e.onResponseComplete(i,g)}}}const $={streaming:"[data-is-streaming='true']",response:".font-claude-message",fallbackResponse:'[data-testid="chat-message-content"]'},Q=300;class ee{constructor(){u(this,"observer",null);u(this,"debounceTimer",null);u(this,"lastSeenContent",null);u(this,"wasStreaming",!1)}start(e){this.observer=new MutationObserver(()=>{this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>this.check(e),Q)}),this.observer.observe(document.body,{childList:!0,subtree:!0,characterData:!0})}stop(){var e;(e=this.observer)==null||e.disconnect(),this.observer=null,this.debounceTimer&&clearTimeout(this.debounceTimer)}readLatestResponse(){var t;const e=this.getLatestResponseEl();return((t=e==null?void 0:e.textContent)==null?void 0:t.trim())||null}isResponseStreaming(){return document.querySelector($.streaming)!==null}getLatestResponseEl(){const e=document.querySelectorAll($.response);if(e.length>0)return e[e.length-1];const t=document.querySelectorAll($.fallbackResponse);return t.length>0?t[t.length-1]:null}check(e){var a;const t=this.isResponseStreaming(),r=this.getLatestResponseEl();if(!r)return;const i=r.getAttribute("data-testid")||"claude-response";if(t&&!this.wasStreaming){this.wasStreaming=!0,e.onResponseStart(i);return}if(!t&&this.wasStreaming){this.wasStreaming=!1;const g=((a=r.textContent)==null?void 0:a.trim())||"";g&&g!==this.lastSeenContent&&(this.lastSeenContent=g,e.onResponseComplete(i,g))}}}const v={response:"model-response",responseText:".model-response-text",fallbackResponse:".response-content",streaming:".loading-indicator, .response-streaming"},te=300;class se{constructor(){u(this,"observer",null);u(this,"debounceTimer",null);u(this,"lastSeenContent",null);u(this,"wasStreaming",!1);u(this,"stableCount",0);u(this,"lastContent",null)}start(e){this.observer=new MutationObserver(()=>{this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>this.check(e),te)}),this.observer.observe(document.body,{childList:!0,subtree:!0,characterData:!0})}stop(){var e;(e=this.observer)==null||e.disconnect(),this.observer=null,this.debounceTimer&&clearTimeout(this.debounceTimer)}readLatestResponse(){var t;const e=this.getLatestResponseEl();return((t=e==null?void 0:e.textContent)==null?void 0:t.trim())||null}isResponseStreaming(){if(document.querySelector(v.streaming))return!0;const e=this.readLatestResponse();return e&&e===this.lastContent?this.stableCount++:(this.stableCount=0,this.lastContent=e),this.stableCount<3&&this.lastContent!==this.lastSeenContent}getLatestResponseEl(){const e=document.querySelectorAll(v.response);if(e.length>0)return e[e.length-1];const t=document.querySelectorAll(v.responseText);if(t.length>0)return t[t.length-1];const r=document.querySelectorAll(v.fallbackResponse);return r.length>0?r[r.length-1]:null}check(e){var a;const t=this.isResponseStreaming(),r=this.getLatestResponseEl();if(!r)return;const i="gemini-response";if(t&&!this.wasStreaming){this.wasStreaming=!0,e.onResponseStart(i);return}if(!t&&this.wasStreaming){this.wasStreaming=!1;const g=((a=r.textContent)==null?void 0:a.trim())||"";g&&g!==this.lastSeenContent&&(this.lastSeenContent=g,e.onResponseComplete(i,g))}}}const re=['[data-testid="send-button"]','button[aria-label="Send prompt"]','button[aria-label="Send"]'];function ne(){for(const s of re){const e=document.querySelector(s);if(e&&!e.disabled)return e.click(),!0}return!1}const ie=['button[aria-label="Send message"]','button[aria-label="Send Message"]','button[data-testid="send-button"]'];function oe(){for(const s of ie){const e=document.querySelector(s);if(e&&!e.disabled)return e.click(),!0}return!1}const ae=[".send-button",'button[aria-label="Send"]','button[aria-label="Send message"]','button[data-testid="send-button"]'];function le(){for(const s of ae){const e=document.querySelector(s);if(e&&!e.disabled)return e.click(),!0}return!1}const ce={chatgpt:ne,claude:oe,gemini:le};function ge(s){return ce[s]()}function me(){const s=window.location.hostname;return s.includes("chat.openai.com")||s.includes("chatgpt.com")?"chatgpt":s.includes("claude.ai")?"claude":s.includes("gemini.google.com")?"gemini":null}const U={chatgpt:S,claude:E,gemini:Y};function ue(s){switch(s){case"chatgpt":return new X;case"claude":return new ee;case"gemini":return new se}}function Ae(){const s=document.createElement("div");s.id="contextgit-inject-host";const e=s.attachShadow({mode:"closed"}),t=document.createElement("style");t.textContent=`
    .cg-btn {
      position: fixed;
      bottom: 80px;
      right: 20px;
      z-index: 10000;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #2563eb;
      color: white;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      font-size: 14px;
      font-weight: bold;
      font-family: system-ui, sans-serif;
      transition: transform 0.2s;
    }
    .cg-btn:hover {
      transform: scale(1.1);
    }
  `,e.appendChild(t);const r=document.createElement("button");r.className="cg-btn",r.title="Open ContextGit",r.textContent="CG",r.addEventListener("click",()=>{chrome.runtime.sendMessage({type:"OPEN_SIDEPANEL"})}),e.appendChild(r),document.body.appendChild(s)}function de(s,e){switch(s){case"createIssue":return{type:"API_CREATE_ISSUE",issue:e};case"startIssue":return{type:"API_START_ISSUE",issueId:e.issueId};case"listIssues":return{type:"API_GET_STATE"};case"createPR":return{type:"API_CREATE_PR",issueId:e.issueId};case"reviewPR":return{type:"API_REVIEW_PR",prId:e.prId,action:e.action,comment:e.comment};case"mergePR":return{type:"API_MERGE_PR",prId:e.prId};case"listPRs":return{type:"API_GET_STATE"};case"getState":return{type:"API_GET_STATE"};case"startWorkflow":return{type:"API_START_WORKFLOW",issues:e.issues,sendMode:e.sendMode};case"injectPrompt":return{type:"BG_INJECT_PROMPT",prompt:e.prompt,autoSend:e.autoSend??!1};case"readResponse":return{type:"BG_READ_RESPONSE"};default:return null}}let he=0;const fe={matches:["https://chat.openai.com/*","https://chatgpt.com/*","https://claude.ai/*","https://gemini.google.com/*"],main(){const s=me();if(!s)return;Ae();const e=ue(s);e.start({onResponseStart(t){console.debug("[ContextGit] Response streaming started:",t)},onResponseComplete(t,r){const i={id:`${s}-${++he}`,platform:s,content:r,timestamp:new Date().toISOString(),isStreaming:!1};chrome.runtime.sendMessage({type:"CS_RESPONSE_COMPLETE",platform:s,response:i})}}),chrome.runtime.sendMessage({type:"CS_READY",platform:s}),window.addEventListener("message",t=>{var p;if(t.source!==window||((p=t.data)==null?void 0:p.source)!=="contextgit-mcp")return;const{action:r,payload:i,requestId:a}=t.data,g=de(r,i);if(!g){window.postMessage({source:"contextgit-mcp-response",requestId:a,error:`Unknown action: ${r}`},"*");return}chrome.runtime.sendMessage(g,B=>{window.postMessage({source:"contextgit-mcp-response",requestId:a,response:B},"*")})}),chrome.runtime.onMessage.addListener((t,r,i)=>{switch(t.type){case"INJECT_CONTEXT":{const a=U[s];if(!a(t.content))return navigator.clipboard.writeText(t.content).then(()=>i({success:!0,fallback:"clipboard"}),()=>i({success:!1,error:"Injection failed"})),!0;i({success:!0});break}case"BG_INJECT_PROMPT":{const a=U[s],g=a(t.prompt);if(g&&t.autoSend)return setTimeout(()=>{const p=ge(s);i({success:!0,sent:p})},200),!0;i({success:g,sent:!1});break}case"BG_READ_RESPONSE":{const a=e.readLatestResponse(),g=e.isResponseStreaming();i({content:a,isStreaming:g});break}case"BG_GET_STATUS":{i({platform:s,streaming:e.isResponseStreaming(),ready:!0});break}}return!0})}};function be(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var R={exports:{}},pe=R.exports,W;function xe(){return W||(W=1,(function(s,e){(function(t,r){r(s)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:pe,function(t){if(!(globalThis.chrome&&globalThis.chrome.runtime&&globalThis.chrome.runtime.id))throw new Error("This script should only be loaded in a browser extension.");if(globalThis.browser&&globalThis.browser.runtime&&globalThis.browser.runtime.id)t.exports=globalThis.browser;else{const r="The message port closed before a response was received.",i=a=>{const g={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(g).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class p extends WeakMap{constructor(o,c=void 0){super(c),this.createItem=o}get(o){return this.has(o)||this.set(o,this.createItem(o)),super.get(o)}}const B=n=>n&&typeof n=="object"&&typeof n.then=="function",V=(n,o)=>(...c)=>{a.runtime.lastError?n.reject(new Error(a.runtime.lastError.message)):o.singleCallbackArg||c.length<=1&&o.singleCallbackArg!==!1?n.resolve(c[0]):n.resolve(c)},M=n=>n==1?"argument":"arguments",Re=(n,o)=>function(m,...d){if(d.length<o.minArgs)throw new Error(`Expected at least ${o.minArgs} ${M(o.minArgs)} for ${n}(), got ${d.length}`);if(d.length>o.maxArgs)throw new Error(`Expected at most ${o.maxArgs} ${M(o.maxArgs)} for ${n}(), got ${d.length}`);return new Promise((h,f)=>{if(o.fallbackToNoCallback)try{m[n](...d,V({resolve:h,reject:f},o))}catch(l){console.warn(`${n} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,l),m[n](...d),o.fallbackToNoCallback=!1,o.noCallback=!0,h()}else o.noCallback?(m[n](...d),h()):m[n](...d,V({resolve:h,reject:f},o))})},z=(n,o,c)=>new Proxy(o,{apply(m,d,h){return c.call(d,n,...h)}});let N=Function.call.bind(Object.prototype.hasOwnProperty);const L=(n,o={},c={})=>{let m=Object.create(null),d={has(f,l){return l in n||l in m},get(f,l,b){if(l in m)return m[l];if(!(l in n))return;let A=n[l];if(typeof A=="function")if(typeof o[l]=="function")A=z(n,n[l],o[l]);else if(N(c,l)){let y=Re(l,c[l]);A=z(n,n[l],y)}else A=A.bind(n);else if(typeof A=="object"&&A!==null&&(N(o,l)||N(c,l)))A=L(A,o[l],c[l]);else if(N(c,"*"))A=L(A,o[l],c["*"]);else return Object.defineProperty(m,l,{configurable:!0,enumerable:!0,get(){return n[l]},set(y){n[l]=y}}),A;return m[l]=A,A},set(f,l,b,A){return l in m?m[l]=b:n[l]=b,!0},defineProperty(f,l,b){return Reflect.defineProperty(m,l,b)},deleteProperty(f,l){return Reflect.deleteProperty(m,l)}},h=Object.create(n);return new Proxy(h,d)},K=n=>({addListener(o,c,...m){o.addListener(n.get(c),...m)},hasListener(o,c){return o.hasListener(n.get(c))},removeListener(o,c){o.removeListener(n.get(c))}}),Pe=new p(n=>typeof n!="function"?n:function(c){const m=L(c,{},{getContent:{minArgs:0,maxArgs:0}});n(m)}),H=new p(n=>typeof n!="function"?n:function(c,m,d){let h=!1,f,l=new Promise(C=>{f=function(x){h=!0,C(x)}}),b;try{b=n(c,m,f)}catch(C){b=Promise.reject(C)}const A=b!==!0&&B(b);if(b!==!0&&!A&&!h)return!1;const y=C=>{C.then(x=>{d(x)},x=>{let G;x&&(x instanceof Error||typeof x.message=="string")?G=x.message:G="An unexpected error occurred",d({__mozWebExtensionPolyfillReject__:!0,message:G})}).catch(x=>{console.error("Failed to send onMessage rejected reply",x)})};return y(A?b:l),!0}),_e=({reject:n,resolve:o},c)=>{a.runtime.lastError?a.runtime.lastError.message===r?o():n(new Error(a.runtime.lastError.message)):c&&c.__mozWebExtensionPolyfillReject__?n(new Error(c.message)):o(c)},J=(n,o,c,...m)=>{if(m.length<o.minArgs)throw new Error(`Expected at least ${o.minArgs} ${M(o.minArgs)} for ${n}(), got ${m.length}`);if(m.length>o.maxArgs)throw new Error(`Expected at most ${o.maxArgs} ${M(o.maxArgs)} for ${n}(), got ${m.length}`);return new Promise((d,h)=>{const f=_e.bind(null,{resolve:d,reject:h});m.push(f),c.sendMessage(...m)})},ke={devtools:{network:{onRequestFinished:K(Pe)}},runtime:{onMessage:K(H),onMessageExternal:K(H),sendMessage:J.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:J.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},D={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return g.privacy={network:{"*":D},services:{"*":D},websites:{"*":D}},L(a,ke,g)};t.exports=i(chrome)}})})(R)),R.exports}var Se=xe();const P=be(Se);function _(s,...e){}const we={debug:(...s)=>_(console.debug,...s),log:(...s)=>_(console.log,...s),warn:(...s)=>_(console.warn,...s),error:(...s)=>_(console.error,...s)},I=class I extends Event{constructor(e,t){super(I.EVENT_NAME,{}),this.newUrl=e,this.oldUrl=t}};u(I,"EVENT_NAME",F("wxt:locationchange"));let q=I;function F(s){var e;return`${(e=P==null?void 0:P.runtime)==null?void 0:e.id}:content:${s}`}function Ee(s){let e,t;return{run(){e==null&&(t=new URL(location.href),e=s.setInterval(()=>{let r=new URL(location.href);r.href!==t.href&&(window.dispatchEvent(new q(r,t)),t=r)},1e3))}}}const T=class T{constructor(e,t){u(this,"isTopFrame",window.self===window.top);u(this,"abortController");u(this,"locationWatcher",Ee(this));u(this,"receivedMessageIds",new Set);this.contentScriptName=e,this.options=t,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}get signal(){return this.abortController.signal}abort(e){return this.abortController.abort(e)}get isInvalid(){return P.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(e){return this.signal.addEventListener("abort",e),()=>this.signal.removeEventListener("abort",e)}block(){return new Promise(()=>{})}setInterval(e,t){const r=setInterval(()=>{this.isValid&&e()},t);return this.onInvalidated(()=>clearInterval(r)),r}setTimeout(e,t){const r=setTimeout(()=>{this.isValid&&e()},t);return this.onInvalidated(()=>clearTimeout(r)),r}requestAnimationFrame(e){const t=requestAnimationFrame((...r)=>{this.isValid&&e(...r)});return this.onInvalidated(()=>cancelAnimationFrame(t)),t}requestIdleCallback(e,t){const r=requestIdleCallback((...i)=>{this.signal.aborted||e(...i)},t);return this.onInvalidated(()=>cancelIdleCallback(r)),r}addEventListener(e,t,r,i){var a;t==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),(a=e.addEventListener)==null||a.call(e,t.startsWith("wxt:")?F(t):t,r,{...i,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),we.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:T.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName,messageId:Math.random().toString(36).slice(2)},"*")}verifyScriptStartedEvent(e){var a,g,p;const t=((a=e.data)==null?void 0:a.type)===T.SCRIPT_STARTED_MESSAGE_TYPE,r=((g=e.data)==null?void 0:g.contentScriptName)===this.contentScriptName,i=!this.receivedMessageIds.has((p=e.data)==null?void 0:p.messageId);return t&&r&&i}listenForNewerScripts(e){let t=!0;const r=i=>{if(this.verifyScriptStartedEvent(i)){this.receivedMessageIds.add(i.data.messageId);const a=t;if(t=!1,a&&(e!=null&&e.ignoreFirstEvent))return;this.notifyInvalidated()}};addEventListener("message",r),this.onInvalidated(()=>removeEventListener("message",r))}};u(T,"SCRIPT_STARTED_MESSAGE_TYPE",F("wxt:content-script-started"));let j=T;const ye=Symbol("null");let Te=0;class Ce extends Map{constructor(){super(),this._objectHashes=new WeakMap,this._symbolHashes=new Map,this._publicKeys=new Map;const[e]=arguments;if(e!=null){if(typeof e[Symbol.iterator]!="function")throw new TypeError(typeof e+" is not iterable (cannot read property Symbol(Symbol.iterator))");for(const[t,r]of e)this.set(t,r)}}_getPublicKeys(e,t=!1){if(!Array.isArray(e))throw new TypeError("The keys parameter must be an array");const r=this._getPrivateKey(e,t);let i;return r&&this._publicKeys.has(r)?i=this._publicKeys.get(r):t&&(i=[...e],this._publicKeys.set(r,i)),{privateKey:r,publicKey:i}}_getPrivateKey(e,t=!1){const r=[];for(let i of e){i===null&&(i=ye);const a=typeof i=="object"||typeof i=="function"?"_objectHashes":typeof i=="symbol"?"_symbolHashes":!1;if(!a)r.push(i);else if(this[a].has(i))r.push(this[a].get(i));else if(t){const g=`@@mkm-ref-${Te++}@@`;this[a].set(i,g),r.push(g)}else return!1}return JSON.stringify(r)}set(e,t){const{publicKey:r}=this._getPublicKeys(e,!0);return super.set(r,t)}get(e){const{publicKey:t}=this._getPublicKeys(e);return super.get(t)}has(e){const{publicKey:t}=this._getPublicKeys(e);return super.has(t)}delete(e){const{publicKey:t,privateKey:r}=this._getPublicKeys(e);return!!(t&&super.delete(t)&&this._publicKeys.delete(r))}clear(){super.clear(),this._symbolHashes.clear(),this._publicKeys.clear()}get[Symbol.toStringTag](){return"ManyKeysMap"}get size(){return super.size}}new Ce;function Le(){}function k(s,...e){}const ve={debug:(...s)=>k(console.debug,...s),log:(...s)=>k(console.log,...s),warn:(...s)=>k(console.warn,...s),error:(...s)=>k(console.error,...s)};return(async()=>{try{const{main:s,...e}=fe,t=new j("content",e);return await s(t)}catch(s){throw ve.error('The content script "content" crashed on startup!',s),s}})()})();
content;
